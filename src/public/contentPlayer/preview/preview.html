<!DOCTYPE html>
<html ng-app="genie-canvas">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title></title>

    <!-- injector:css -->
    <link rel="stylesheet" href="style.min.1.1.css">
    <!-- endinjector -->

    <style>
        #gameArea {
            position: absolute;
            left: 50%;
            top: 50%;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
        }

        .inputText {
            -moz-border-radius: 15px;
            border-radius: 15px;
            border: solid 2px black !important;
            font-size: 15px !important;
            padding-left: 10px !important;
            font-weight: bold !important;
            padding-right: 5px;
            z-index: 1000;
            text-align: center;
        }
    </style>
</head>

<body ng-controller="BaseCtrl">
    <div id="loading" class="gc-loader-area"></div>

    <div class="content-holder" ng-repeat="template in templates">
        <div ng-include="template.path || template.id"></div>
    </div>

    <!-- injector:js -->
    <script src="script.min.1.1.js"></script>
    <script src="https://unpkg.com/peerjs@1.0.0/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mobile-detect@1.4.4/mobile-detect.min.js"></script>
    <!-- endinjector -->
</body>
<script>
    
        
    var peer = new Peer('smrtdesktopapp');
    console.log("You are the receiver")
    peer.on('open', function(id) {
        console.log('My peer ID is: ' + id);
    });
    peer.on('connection', function (conn) {
        conn.on('data', function (data) {
            // Will print 'hi!'
            console.log("Received data:", data, $(document).height(), $(document).width());
            click(data.x, data.y)
        });
    });

    function click(x, y){
        var screenX = x * $(document).width();
        var screenY = y * $(document).height();
        var ev = new MouseEvent('click', {
            'view': window,
            'bubbles': true,
            'cancelable': false,
            'screenX': screenX,
            'screenY': screenY
        });
        var el = document.elementFromPoint(screenX, screenY);
        console.log('Element at point - ', el);
        $(el).click();
    }
    
    var speechRecognitionEnabled = false;
    function executeCommand(command, data) {
        switch (command) {
            case 'next':
                if ($('custom-next-navigation > div > a > img') && $('custom-next-navigation > div > a > img').length > 0) {
                    $($('custom-next-navigation > div > a > img')[0]).click();
                } else {
                    EkstepRendererAPI.next();
                }
                break;
            case 'previous':

                if ($('custom-previous-navigation > div > a > img') && $('custom-next-navigation > div > a > img').length > 0) {
                    $($('custom-previous-navigation > div > a > img')[0]).click();
                } else {
                    EkstepRendererAPI.previous();
                }
                break;
            case 'replay':
                EkstepRendererAPI.replayContent();
                EkstepRendererAPI.hideEndPage();
                EkstepRendererAPI.dispatchEvent('renderer:content:replay');
                break;
            case 'select':
                var option = parseInt(data);
                $($('.option-block')[option - 1]).trigger("click");
                break;
            default:
                console.log('unknown command')
        }
    }
    setTimeout(() => {
        window.SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
        var recognition = new window.SpeechRecognition();
        recognition.onresult = (event) => {
            console.log('event', event);
            const speechToText = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
            console.log("speechToText : " + speechToText)
            if (speechToText.indexOf('next') != -1) {
                executeCommand('next')
            }
            if (speechToText.indexOf("replay") != -1 || speechToText.indexOf("reply") != -1) {
                executeCommand('replay')
            }
            if (speechToText.startsWith("prev") || speechToText.indexOf("prev") != -1) {
                executeCommand('previous')
            }
            if (speechToText.indexOf("select") != -1) {
                if (speechToText.indexOf('1') != -1 || speechToText.indexOf('one') != -1) {
                    executeCommand('select', 1);
                }
                if (speechToText.indexOf('2') != -1 || speechToText.indexOf('two') != -1) {
                    executeCommand('select', 2);
                }
                if (speechToText.indexOf('3') != -1 || speechToText.indexOf('three') != -1) {
                    executeCommand('select', 3);
                }
                if (speechToText.indexOf('4') != -1 || speechToText.indexOf('for') != -1 || speechToText.indexOf('four') != -1) {
                    executeCommand('select', 4);
                }
                if (speechToText.indexOf('5') != -1 || speechToText.indexOf('five') != -1) {
                    executeCommand('select', 5);
                }
                if (speechToText.indexOf('6') != -1) {
                    executeCommand('select', 6);
                }
            }
        }
        recognition.onnomatch = function () {
            console.log('Speech not recognised');
        }
        recognition.continuous = true
        recognition.interimResults = false;
        if(speechRecognitionEnabled) recognition.start()
    }, 5000)
</script>

</html>